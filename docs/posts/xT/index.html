<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gareth Edwards">
<meta name="dcterms.date" content="2024-08-15">

<title>Simply Foot - Italian xT</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Simply Foot</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Gareth1995" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/Gareth_FDS" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Italian xT</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Football</div>
                <div class="quarto-category">xT</div>
                <div class="quarto-category">Serie A</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Gareth Edwards </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 15, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Expected threat, or xT, is a concept widely spoken, widely used and already well known. To hop onto the trend, I made use of the “Calculating xT (position-based)” tutorial presented by soccermatics (https://soccermatics.readthedocs.io/en/latest/gallery/lesson4/plot_ExpectedThreat.html).</p>
<p>In my short project I made use of the Serie A (2015/2016) dataset provided by statsbomb. I extracted data from the top four teams of that year (Inter Milan, Juventus, Napoli, Roma) and compared it to four middle table teams for that season (Lazio, Fiorentina, Empoli, Genoa) across a few sector-based metrics that can be visualized using heatmaps (goal frequency per sector, ball movement rate per sector, shot frequency per sector, xG per sector and xT)</p>
<p>The aim is to look for any visible differences that make top teams different to middle table teams. Perhaps in the plots we see visible areas where middle table teams can make the jump to top table teams, based on their style of attack.</p>
</section>
<section id="ball-movement" class="level1 page-columns page-full">
<h1>Ball Movement</h1>
<p>One fundamental part of football is ball movement. Each team has it’s own pattern in terms of how the ball is moved. Some enjoy play on the flanks and rely more on their wingers to put in crosses, other teams generate more central attacks and make use of creative midfielders while others (although not so often anymore) may use longer passes to move the ball forward quicker, or to overcome a high press. Teams can also change their style from game to game as they adapt to their opponents.</p>
<p>These aspects one would expect to be able to see on a visual, by plotting where on the pitch each team commonly moves the ball. Below is a plot showing the ball movement heatmap of the eight teams we are investigating.</p>
<section id="ball-movement-heatmaps" class="level2 page-columns page-full" style="text-align: center">
<h2 style="text-align: center" class="anchored" data-anchor-id="ball-movement-heatmaps">Ball Movement Heatmaps</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/movement map/legend.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="cell column-page quarto-layout-panel" data-grid-template-columns="repeat(4, 1fr)">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/Juventus_movement_map.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/Napoli_movement_map.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/AS Roma_movement_map.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/Inter Milan_movement_map.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/Fiorentina_movement_map.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/Lazio_movement_map.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/Genoa_movement_map.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/movement map/Empoli_movement_map.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="caption">
<p>Top four plots belong to the top four teams (arranged in order from 1st to 4th going left to right). The bottom row of the plot are the four mid-table clubs in order of their final league positions (5th, 8th, 10th and 11th)</p>
</div>
<div class="key_points">
<p>Here are key observations that stand out when analysing this plot:</p>
<ul>
<li><p>Darker squares in the Juventus and Napoli (placed 1st and 2nd in the league) heatmaps compared to the other clubs. This is an indication of a higher frequency of ball movement.</p></li>
<li><p>The pattern of play is similar amongst all teams in terms of where ball movement happens most (center and then wide).</p></li>
<li><p>Napoli and Inter Milan show a stronger favoritism to move the ball toward the left side of the field.</p></li>
<li><p>Juventus seem to utilize both flanks equally.</p></li>
<li><p>Juventus, Napoli and Empoli have darker middle squares compared to the others, thus showing a stronger reliance on their central midfielders.</p></li>
</ul>
</div>
</section>
</section>
<section id="shot-frequency" class="level1 page-columns page-full">
<h1>Shot Frequency</h1>
<p>Ball movement is only the half of it, if you don’t shoot, you won’t score. Below we visualize plots of shot frequency per sector and we compare the heatmaps between each team.</p>
<section id="shot-heatmaps" class="level2 page-columns page-full" style="text-align: center">
<h2 style="text-align: center" class="anchored" data-anchor-id="shot-heatmaps">Shot Heatmaps</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/shot frequency/legend.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="cell column-page quarto-layout-panel" data-grid-template-columns="repeat(4, 1fr)">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/Juventus_shot_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/Napoli_shot_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/AS Roma_shot_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/Inter Milan_shot_freq.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/Fiorentina_shot_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/Lazio_shot_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/Genoa_shot_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/shot frequency/Empoli_shot_freq.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="key_points">
<p>Key observations:</p>
<ul>
<li><p>Juventus and Napoli are more likely to take shots from outside or on the edge of the box compared to other teams.</p></li>
<li><p>Napoli take more shots from more frequently from the left side of goal compared to other clubs. Perhaps due to a winger often coming inside and shooting (this would need to be investigated more).</p></li>
<li><p>Roma, Inter Milan, Genoa and Empoli take most of their shots from the left side of the penalty spot compared to other teams. Juventus is the only team that favour the sector right of the penalty spot.</p></li>
</ul>
</div>
</section>
</section>
<section id="goal-frequency" class="level1 page-columns page-full">
<h1>Goal Frequency</h1>
<p>In fact, sometimes when you shoot you don’t score… Goals are everything. Below we plot goal frequency per sector for each team and we investigate how these differ from team to team.</p>
<section id="goal-frequency-heatmaps" class="level2 page-columns page-full" style="text-align: center">
<h2 style="text-align: center" class="anchored" data-anchor-id="goal-frequency-heatmaps">Goal Frequency Heatmaps</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/goal frequency/legend.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="cell column-page quarto-layout-panel" data-grid-template-columns="repeat(4, 1fr)">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/Juventus_goal_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/Napoli_goal_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/AS Roma_goal_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/Inter Milan_goal_freq.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/Fiorentina_goal_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/Lazio_goal_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/Genoa_goal_freq.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/goal frequency/Empoli_goal_freq.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="key_points">
<p>Key observations:</p>
<ul>
<li><p>Juventus score more from shots outside the box compared to the other teams. This coincides with their superior shooting frequency from outside the box.</p></li>
<li><p>Inter Milan have a very small segment from which their goals come from. They rely on working the ball into the box around the penalty area. (restricting them to shots from outside the box may be beneficial) A similar pattern is evident for Fiorentina and Genoa.</p></li>
<li><p>Most teams score most of their goals from the 4 sectors just oustide the 6 yard box (focused defense in this section, or prevention of the ball getting into this section could be key).</p></li>
</ul>
</div>
</section>
</section>
<section id="xg" class="level1 page-columns page-full">
<h1>xG</h1>
<p>The expected goals from each section will tell us which sections a team could be most dangerous in. Further investigation should go into which player is most dangerous in each sector. This could improve on defensive tactics, however, it is most likely that the player who scores most should be on the ball the least in the sections where xG is the highest for each team. Below we see the xG heatmap for each team.</p>
<section id="xg-heatmap" class="level2 page-columns page-full" style="text-align: center">
<h2 style="text-align: center" class="anchored" data-anchor-id="xg-heatmap">xG Heatmap</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/xG/legend.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="cell column-page quarto-layout-panel" data-grid-template-columns="repeat(4, 1fr)">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/Juventus_xg.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/Napoli_xg.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/AS Roma_xg.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/Inter Milan_xg.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/Fiorentina_xg.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/Lazio_xg.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/Genoa_xg.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="plots/xG/Empoli_xg.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="caption">
<p>The xG displayed in this plot was calculated by statsBomb</p>
</div>
<div class="key_points">
<p>Key points:</p>
<ul>
<li>xG plots mostly coincide with the goal frequency plots.</li>
</ul>
</div>
</section>
</section>
<section id="xt" class="level1 page-columns page-full">
<h1>xT</h1>
<p>Expected threat is the method that bases a value score on every section on the pitch. When a team has the ball in a sector that has a higher xT than the last, they have effectively increased their chances of scoring a goal. If a team moves the ball from a high xT zone to a lower xT zone they decrease their chances of scoring a goal (theoretically). For further details on xT see the following post <a href="https://karun.in/blog/expected-threat.html">here</a>. Below is a plot of each team’s xT heatmap.</p>
<section id="xt-heatmap" class="level2 page-columns page-full" style="text-align: center">
<h2 style="text-align: center" class="anchored" data-anchor-id="xt-heatmap">xT Heatmap</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="plots/xT/legend.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/Juventus_xt.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/Napoli_xt.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/AS Roma_xt.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/Inter Milan_xt.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/Fiorentina_xt.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/Lazio_xt.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="cell column-page quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/Genoa_xt.png" class="img-fluid"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="plots/xT/Empoli_xt.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="key_points">
<p>Key points:</p>
<ul>
<li><p>Fiorentina, Napoli and Lazio have a higher threat around the penalty area compared to the other teams.</p></li>
<li><p>Juventus have a uniquely high threat in the sector that lies two sectors above the bottom right corner (xT = 0.12).</p></li>
<li><p>Juventus have the highest xT in the 6 yard box compared to the other teams. This is a good indication that Juventus were more clinical with their finishing compared to the other clubs.</p></li>
<li><p>xT is always highest in the four sectors that encompass the penalty spot and the face of the goal. This is the same for all teams.</p></li>
</ul>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>So, what sets the top teams apart from the rest? Below we have some concluding points that became evident in these visualisations:</p>
<ul>
<li><p>Top sides move the ball more.</p></li>
<li><p>Top sides shoot more frequently and take their chances from outside the box too. They, try their luck or have more confidence (further research could be applied here).</p></li>
<li><p>Top teams are more clinical when they get into ideal goal scoring positions.</p></li>
</ul>
<p>There are also some similarities between all clubs that stand out which tell us something about the general game of football:</p>
<ul>
<li><p>The highest threat and most goals scored take place in the sectors that are between the penalty spot and the face of the goal.</p></li>
<li><p>Team movement maps are very similar as the ball often moves to the middle of the pitch and then wide. Very little action takes place in the middle portion of the pitch between the half way line circle and the edge of the box. (These are possibly spaces to exploit. Further analysis could go into player’s off the ball movements)</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>